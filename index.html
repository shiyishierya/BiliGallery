<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - BiliGallery</title>
    <style>
        /* CSS ä¿æŒä¸å˜ (ä»¿Bç«™é£æ ¼) */
        body {
            margin: 0; padding: 0;
            background-image: url('https://s1.hdslb.com/bfs/static/jinkela/long/images/login-bg.png'); 
            background-color: #f4f5f7; background-size: cover; background-position: center;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        .auth-card {
            background: white; width: 820px; height: 420px; display: flex;
            border-radius: 4px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); position: relative; overflow: hidden;
        }
        .auth-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px;
            background: linear-gradient(90deg, #00aeec, #fb7299);
        }
        .auth-left {
            width: 400px; border-right: 1px solid #ddd; display: flex; flex-direction: column;
            justify-content: center; align-items: center; background: #fff;
        }
        .qr-title { font-size: 18px; color: #212121; margin-bottom: 20px; font-weight: 500; }
        .qr-box {
            width: 160px; height: 160px; border: 1px solid #eee; border-radius: 4px; padding: 10px;
            background: #fff; position: relative;
        }
        .qr-img {
            width: 100%; height: 100%;
            background-image: url('https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=BiliGallery'); 
            background-size: cover;
        }
        .qr-tip { margin-top: 15px; font-size: 12px; color: #999; }
        .qr-link { color: #00aeec; cursor: pointer; text-decoration: none; }

        .auth-right { flex: 1; padding: 40px 50px; display: flex; flex-direction: column; justify-content: center; position: relative; }
        .auth-title {
            font-size: 18px; color: #212121; margin-bottom: 30px; text-align: center;
            display: flex; justify-content: center; gap: 20px;
        }
        .tab-btn { cursor: pointer; padding-bottom: 5px; color: #505050; transition: 0.3s; }
        .tab-btn.active { color: #00aeec; border-bottom: 2px solid #00aeec; font-weight: bold; }

        .input-group { margin-bottom: 20px; position: relative; display: flex; gap: 10px; }
        .input-field {
            width: 100%; height: 40px; border: 1px solid #e7e7e7; border-radius: 4px; padding: 0 10px;
            box-sizing: border-box; outline: none; transition: 0.2s; font-size: 14px;
        }
        .input-field:focus { border-color: #00aeec; }
        
        .btn-code {
            width: 120px; height: 40px; background: #fff; border: 1px solid #e7e7e7; color: #505050;
            border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap;
        }
        .btn-code:hover { color: #00aeec; border-color: #00aeec; }
        .btn-code:disabled { color: #999; cursor: not-allowed; border-color: #eee; }

        .btn-login {
            width: 100%; height: 40px; background: #00aeec; color: white; border: none;
            border-radius: 4px; font-size: 14px; cursor: pointer; transition: 0.2s;
        }
        .btn-login:hover { background: #00a1d6; }

        .auth-footer { margin-top: 15px; display: flex; justify-content: space-between; font-size: 12px; }
        .link { color: #00aeec; text-decoration: none; cursor: pointer; }
        .hidden { display: none; }

        /* ğŸ”¥ æ–°å¢ï¼šæ¸¸å®¢è®¿é—®é“¾æ¥ */
        .guest-link {
            position: absolute; top: 10px; right: 15px; font-size: 12px; color: #999; text-decoration: none;
            transition: 0.2s; cursor: pointer;
        }
        .guest-link:hover { color: #fb7299; }

        /* å¿˜è®°å¯†ç å¼¹çª— */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
            display: none; justify-content: center; align-items: center; z-index: 999;
        }
        .modal-box { background: white; padding: 25px; border-radius: 8px; width: 360px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .modal-header { font-size: 18px; font-weight: bold; margin-bottom: 20px; text-align: center; color: #333; }
        .close-btn { float: right; cursor: pointer; font-size: 20px; color: #999; margin-top: -5px; }
        .btn-reset { width: 100%; height: 40px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="auth-card">
        <div class="auth-left">
            <div class="qr-title">æ‰«æäºŒç»´ç ç™»å½•</div>
            <div class="qr-box"><div class="qr-img"></div></div>
            <div class="qr-tip">è¯·ä½¿ç”¨ <span class="qr-link">å®¢æˆ·ç«¯</span> æ‰«ç ç™»å½•</div>
        </div>
        
        <div class="auth-right">
            <a href="gallery.html" class="guest-link">æ¸¸å®¢è®¿é—® &gt;</a>

            <div class="auth-title">
                <span class="tab-btn active" onclick="switchLoginTab('pwd')">å¯†ç ç™»å½•</span>
                <span class="tab-btn" onclick="switchLoginTab('sms')">çŸ­ä¿¡ç™»å½•</span>
            </div>
            
            <div id="pwdBox">
                <div class="input-group">
                    <input type="text" id="account" class="input-field" placeholder="æ‰‹æœºå· / é‚®ç®±">
                </div>
                <div class="input-group">
                    <input type="password" id="password" class="input-field" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
            </div>

            <div id="smsBox" class="hidden">
                <div class="input-group">
                    <input type="text" id="smsPhone" class="input-field" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
                </div>
                <div class="input-group">
                    <input type="text" id="smsCode" class="input-field" placeholder="è¯·è¾“å…¥éªŒè¯ç ">
                    <button id="getCodeBtn" class="btn-code">è·å–éªŒè¯ç </button>
                </div>
            </div>
            
            <button id="loginBtn" class="btn-login">ç™»å½•</button>
            
            <div class="auth-footer">
                <a href="register.html" class="link">æ³¨å†Œè´¦å·</a>
                <span class="link" onclick="openForgotModal()">å¿˜è®°å¯†ç ï¼Ÿ</span>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="forgotModal">
        <div class="modal-box">
            <span class="close-btn" onclick="closeForgotModal()">Ã—</span>
            <div class="modal-header">é‡ç½®å¯†ç </div>
            <div class="input-group">
                <input type="text" id="forgotAccount" class="input-field" placeholder="è¯·è¾“å…¥æ³¨å†Œçš„æ‰‹æœºå·/é‚®ç®±">
            </div>
            <div class="input-group">
                <input type="text" id="forgotCode" class="input-field" placeholder="éªŒè¯ç ">
                <button id="forgotGetCodeBtn" class="btn-code">è·å–éªŒè¯ç </button>
            </div>
            <div class="input-group">
                <input type="password" id="newResetPass" class="input-field" placeholder="æ–°å¯†ç  (6ä½ä»¥ä¸Š)">
            </div>
            <button id="resetBtn" class="btn-reset">ç¡®è®¤é‡ç½®</button>
        </div>
    </div>

    <script type="module">
        import { loginUser, findUser, resetPassword } from './js/modules/utils.js';

        let loginType = 'pwd'; 
        let currentSmsCode = ''; 
        let currentForgotCode = '';

        window.switchLoginTab = function(type) {
            loginType = type;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            if(type === 'pwd') {
                document.getElementById('pwdBox').classList.remove('hidden');
                document.getElementById('smsBox').classList.add('hidden');
            } else {
                document.getElementById('pwdBox').classList.add('hidden');
                document.getElementById('smsBox').classList.remove('hidden');
            }
        };

        function sendMockCode(btnId, accountId, codeVarName) {
            const btn = document.getElementById(btnId);
            const account = document.getElementById(accountId).value.trim();
            if(!account) return alert('è¯·è¾“å…¥è´¦å·');
            const user = findUser(account);
            if(!user) return alert('è¯¥è´¦å·æœªæ³¨å†Œ');

            const code = Math.floor(100000 + Math.random() * 900000).toString();
            if(codeVarName === 'sms') currentSmsCode = code;
            if(codeVarName === 'forgot') currentForgotCode = code;

            alert(`ã€BiliGalleryã€‘æ‚¨çš„éªŒè¯ç æ˜¯ï¼š${code}ï¼Œè¯·åœ¨5åˆ†é’Ÿå†…è¾“å…¥ã€‚`);

            let left = 60;
            btn.disabled = true;
            btn.innerText = `${left}s`;
            const timer = setInterval(() => {
                left--;
                btn.innerText = `${left}s`;
                if(left <= 0) { clearInterval(timer); btn.disabled = false; btn.innerText = 'è·å–éªŒè¯ç '; }
            }, 1000);
        }

        document.getElementById('getCodeBtn').addEventListener('click', () => sendMockCode('getCodeBtn', 'smsPhone', 'sms'));
        document.getElementById('forgotGetCodeBtn').addEventListener('click', () => sendMockCode('forgotGetCodeBtn', 'forgotAccount', 'forgot'));

        document.getElementById('loginBtn').addEventListener('click', () => {
            let account, password;
            if(loginType === 'pwd') {
                account = document.getElementById('account').value.trim();
                password = document.getElementById('password').value.trim();
                if(!account || !password) return alert('è¯·è¾“å…¥å®Œæ•´ä¿¡æ¯');
                if(loginUser(account, password)) window.location.href = 'gallery.html';
                else alert('è´¦å·æˆ–å¯†ç é”™è¯¯');
            } else {
                account = document.getElementById('smsPhone').value.trim();
                const code = document.getElementById('smsCode').value.trim();
                if(!account || !code) return alert('è¯·è¾“å…¥æ‰‹æœºå·å’ŒéªŒè¯ç ');
                if(code !== currentSmsCode) return alert('éªŒè¯ç é”™è¯¯');
                if(loginUser(account, null)) window.location.href = 'gallery.html';
                else alert('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·');
            }
        });

        window.openForgotModal = () => document.getElementById('forgotModal').style.display = 'flex';
        window.closeForgotModal = () => document.getElementById('forgotModal').style.display = 'none';

        document.getElementById('resetBtn').addEventListener('click', () => {
            const acc = document.getElementById('forgotAccount').value.trim();
            const code = document.getElementById('forgotCode').value.trim();
            const newPass = document.getElementById('newResetPass').value.trim();
            if(!acc || !code || !newPass) return alert('è¯·å¡«å†™å®Œæ•´');
            if(code !== currentForgotCode) return alert('éªŒè¯ç é”™è¯¯');
            if(newPass.length < 6) return alert('æ–°å¯†ç å¤ªçŸ­');
            const res = resetPassword(acc, newPass);
            alert(res.msg);
            if(res.success) closeForgotModal();
        });
        
        document.addEventListener('keydown', (e) => { if(e.key === 'Enter') document.getElementById('loginBtn').click(); });
    </script>
</body>
</html>